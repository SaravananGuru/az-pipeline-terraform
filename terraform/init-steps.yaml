---

parameters:
  - name: workingDirectory
    type: string
  - name: secureVarsFile
    type: string
  - name: terraformVersion
    type: string
    default: 'latest'

steps:
  - task: InstallSSHKey@0
    displayName: 'Install SSH key'
    inputs:
      knownHostsEntry: 'ssh.dev.azure.com,20.42.134.4 ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC7Hr1oTWqNqOlzGJOfGJ4NakVyIzf1rXYd4d7wo6jBlkLvCA4odBlL0mDUyZ0/QUfTTqeu+tm22gOsv+VrVTMk6vwRU75gY/y9ut5Mb3bR5BV58dKXyq9A9UeB5Cakehn5Zgm6x1mKoVyf+FFn26iYqXJRgzIZZcZ5V6hrE0Qg39kZm4az48o0AUbf6Sp4SLdvnuMa2sVNwHBboS7EJkm57XQPVU3/QpyNLHbWDdzwtrlS+ez30S3AdYhLKEOxAG8weOnyrtLJAUen9mTkol8oII1edf7mWWbWVf0nBmly21+nZcmCTISQBtdcyPaEno7fFQMDD26/s0lfKob4Kw8H'
      sshPublicKey: 'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDWKb0fN/dhluySeFGASlj0eWgeA8Ljc4pnGN3fh+dsXNsL3uHhA01aYHKLGLsa7/6W2iGFUvKfNrYKlSgXFK1JdHXf+/plZOxa1oqR9Ro/VxdcbjsZO7cFCRTq9AA2AAe5b2uhREgz6dG5pyauD5Gex6+RNXX3MIAPR1deG8uAeRvHYUXRY505YnG/pm7cBPMGlaGFsNQG99DVVAunIW90YqQmAGbZu1ghK/DmYBkUaZka4yRwHfeelKmKM1qFXfUXzqyxXMomut+5lVPF6vYNRjQFgOHUvkvyphHyPSm/GQseXeWlBtgDfGb/Ww+TNJQVEYQmZoD18zY4XAbP4wN2RU3ljdETUCFrNVJSZuvjQxPIQbrK2NyJ0y23/tITsGYMZ3IXggfdZVC/3kAjtnR47cbHQzmJkmIXHDBq4frPjj6RF857ilAT3pfFGcwJ2S9Cf8q0cfCjmbWEopZPw5gNfsVUlX4wnmiHhebYD237NBIHaGIRTUTucq+/fO6+L7k= northamerica\jaceval@SurfaceLaptop3-UDRVMGP'
      sshPassphrase: '123qwe'
      sshKeySecureFile: terraform_key

  - task: TerraformInstaller@0
    displayName: 'Install Terraform (version: ${{ parameters.terraformVersion }})'
    inputs:
      terraformVersion: '${{ parameters.terraformVersion }}'

  - task: Bash@3
    displayName: 'Clean up .terraform'
    inputs:
      targetType: 'inline'
      script: 'rm -rf ${{ parameters.workingDirectory }}/.terraform'
      workingDirectory: '$(System.DefaultWorkingDirectory)'


  - task: TerraformCLI@0
    displayName: 'Initialize terraform'
    inputs:
      command: 'init'
      commandOptions: '-upgrade'
      workingDirectory: ${{ parameters.workingDirectory }}
      secureVarsFile: ${{ parameters.secureVarsFile }}
